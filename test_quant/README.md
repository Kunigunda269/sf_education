# Анализатор Ордер Блоков и Имбалансов (FVG)

Этот проект — простой пример того, как можно находить ордер блоки и имбалансы (FVG) на исторических данных по рынку. Всё написано максимально понятно и подробно, чтобы даже новичок смог разобраться.

---

## Что такое ордер блок и имбаланс?

- **Ордер блок (Order Block, OB)** — это особая свечная комбинация на графике, которая часто становится зоной, откуда цена может начать сильное движение. Обычно это две свечи подряд одного цвета (например, две красные), за которыми идёт свеча противоположного цвета (например, зелёная). Диапазон ордер блока — это тело второй свечи (или вся свеча, если тень больше тела).

- **Имбаланс (Fair Value Gap, FVG)** — это "пустота" между high одной свечи и low другой свечи, которую не перекрыла средняя свеча. Это место, где цена двигалась слишком быстро, и там может быть интерес для трейдеров.

---

## Как работает этот скрипт?

1. **Загружает исторические данные из файла** (CSV, минутные свечи).
2. **Строит свечи для таймфреймов 1 час и 15 минут** (агрегирует минутные данные).
3. **Находит ордер блоки на часовом графике** по простому паттерну:
   - Две свечи подряд одного цвета (например, две красные), затем свеча противоположного цвета (например, зелёная).
   - Диапазон блока — тело второй свечи (или вся свеча, если тень больше тела).
4. **Находит имбалансы (FVG) на 15-минутках**:
   - Бычий FVG: между high первой свечи и low третьей свечи есть гэп (пустота).
   - Медвежий FVG: между low первой свечи и high третьей свечи есть гэп.
5. **Фильтрует имбалансы**:
   - Оставляет только те, которые попадают в диапазон ордер блока и совпадают по направлению (бычий к бычьему, медвежий к медвежьему).
   - Если имбаланс выходит за границы блока — обрезает его по границам блока.
6. **Формирует итоговую таблицу**:
   - Сначала идёт ордер блок, затем все имбалансы внутри него.
   - Время и цены — в том же формате, что и в исходном файле.
7. **Сохраняет результат в Excel-файл**.

---

## Как пользоваться этим проектом?

1. **Скачайте или скопируйте проект** в отдельную папку.
2. **Положите файл с историческими данными** (например, `correct NQ 06-25 20250319-20250320.csv`) в эту же папку.
3. **Установите Python** (если ещё не установлен).
4. **Создайте виртуальное окружение** (по желанию, но лучше так):
   ```bash
   python -m venv venv
   venv\Scripts\activate  # для Windows
   # или
   source venv/bin/activate  # для Linux/Mac
   ```
5. **Установите нужные библиотеки**:
   ```bash
   pip install pandas openpyxl
   ```
6. **Запустите скрипт**:
   ```bash
   python market_analysis.py
   ```
7. **Посмотрите результат** — он появится в файле `market_analysis_results.xlsx` в этой же папке.

---

## Как устроен результат?

В Excel-файле будет таблица с такими колонками:
- **Type** — Order Block (ордер блок) или Imbalance (имбаланс)
- **Direction** — Bullish (бычий) или Bearish (медвежий)
- **Time** — время формирования (всегда вторая свеча для блока и для имбаланса)
- **Price Range** — диапазон цен (например, 19809.25$-19875.75$)

Сначала идёт ордер блок, затем все имбалансы, которые попали в его диапазон.

---

## Как это работает на практике (пример)

1. На часовом графике найден бычий ордер блок:
   - Время: 17:00 19.03.2025
   - Диапазон: 19809.25$-19875.75$
2. Внутри этого блока на 15-минутках найдено несколько бычьих имбалансов:
   - 13:45 19.03.2025: 19814.75$-19822.75$
   - 18:00 19.03.2025: 19825.50$-19859.50$
   - ...

---

## Важно для джуна!

- Весь код написан максимально просто: только циклы, условия, явные переменные.
- Нет сложных конструкций, всё можно читать по шагам.
- Если что-то не понятно — смотри функции `find_order_blocks`, `find_imbalances`, `combine_ob_and_fvg`.
- Можно менять параметры, экспериментировать с файлами и смотреть, как меняется результат.

---

## Если что-то не работает

- Проверь, что файл с данными лежит в той же папке, что и скрипт.
- Проверь, что названия файлов совпадают.
- Проверь, что установлены библиотеки `pandas` и `openpyxl`.
- Если что-то не понятно — читай код, там всё максимально просто!

---

Удачи в изучении и тестировании! Если нужно — можно доработать под себя или задать вопросы наставнику. 